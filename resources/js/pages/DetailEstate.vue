<template>
    <!-- <main> -->
    <div class="p-0 bg-white">
        <div class="detail_swiper">
            <div class="detail_swiper_block bg-gray">
                <div class="container">
                    <div class="swiper detail-slide_swiper">
                        <div class="swiper-wrapper">
                            <div class="swiper-slide">
                                <div class="property-archive_item">
                                    <a href="propertys_detail.php">
                                        <div class="property_img">
                                            <img
                                                src="/assets/images/property-detail/img.jpg"
                                                alt=""
                                                class="img-fluid"
                                            />
                                            <div class="group_price">
                                                <div class="g-bg">
                                                    <div class="g-bg_item bg-yellow"></div>
                                                    <p class="total_price">
                                                        5400<span class="unit">万円</span
                                                        ><span class="sub">リノベ済</span>
                                                    </p>
                                                </div>

                                                <div class="g-bg">
                                                    <div class="g-bg_item bg-gray"></div>
                                                    <p class="price_info">仲介手数料無料</p>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="w_property-archive_head">
                                            <div class="property-archive_head">
                                                <div class="property_info">
                                                    <p class="property_name">麻布狸穴ナショナルコート</p>
                                                    <p class="property_address">
                                                        <span>東京都中央区日本橋／56.56㎡／ワンルーム</span>
                                                    </p>
                                                </div>
                                                <!-- <div class="property_wishlist">
                                                        <a class="btn_wishlist" href="#"></a>
                                                    </div> -->
                                            </div>
                                        </div>
                                    </a>
                                </div>
                                <div class="property-detail_info">
                                    <img class="img-fluid" src="/assets/images/common/logo-logrenove.svg" />
                                    <h3>天然木材をふんだんに使った香り高いリノベーション</h3>
                                    <p>
                                        ウォルナット、オークなど人気の天然木をふんだんに使ったパッケージリノベーションです。ドアなどの建具も天然木を使用した「木の香りあふれる部屋」に仕上がります。
                                    </p>
                                    <a href="" class="btn btn-check">詳細をcheck!</a>
                                </div>
                            </div>
                            <div class="swiper-slide">
                                <div class="property-archive_item">
                                    <a href="propertys_detail.php">
                                        <div class="property_img">
                                            <img
                                                src="/assets/images/property-detail/img.jpg"
                                                alt=""
                                                class="img-fluid"
                                            />
                                            <div class="group_price">
                                                <div class="g-bg">
                                                    <div class="g-bg_item bg-yellow"></div>
                                                    <p class="total_price">
                                                        5400<span class="unit">万円</span
                                                        ><span class="sub">リノベ済</span>
                                                    </p>
                                                </div>

                                                <div class="g-bg">
                                                    <div class="g-bg_item bg-gray"></div>
                                                    <p class="price_info">仲介手数料無料</p>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="w_property-archive_head">
                                            <div class="property-archive_head">
                                                <div class="property_info">
                                                    <p class="property_name">麻布狸穴ナショナルコート</p>
                                                    <p class="property_address">
                                                        <span>東京都中央区日本橋／56.56㎡／ワンルーム</span>
                                                    </p>
                                                </div>
                                                <!-- <div class="property_wishlist">
                                                        <a class="btn_wishlist" href="#"></a>
                                                    </div> -->
                                            </div>
                                        </div>
                                    </a>
                                </div>
                                <div class="property-detail_info">
                                    <img class="img-fluid" src="/assets/images/common/logo-assy.png" />
                                    <h3>天然木材をふんだんに使った香り高いリノベーション</h3>
                                    <p>
                                        ウォルナット、オークなど人気の天然木をふんだんに使ったパッケージリノベーションです。ドアなどの建具も天然木を使用した「木の香りあふれる部屋」に仕上がります。
                                    </p>
                                    <a href="" class="btn btn-check">詳細をcheck!</a>
                                </div>
                            </div>
                            <div class="swiper-slide">
                                <div class="property-archive_item">
                                    <a href="propertys_detail.php">
                                        <div class="property_img">
                                            <img
                                                src="/assets/images/property-detail/img.jpg"
                                                alt=""
                                                class="img-fluid"
                                            />
                                            <div class="group_price">
                                                <div class="g-bg">
                                                    <div class="g-bg_item bg-yellow"></div>
                                                    <p class="total_price">
                                                        5400<span class="unit">万円</span
                                                        ><span class="sub">リノベ済</span>
                                                    </p>
                                                </div>

                                                <div class="g-bg">
                                                    <div class="g-bg_item bg-gray"></div>
                                                    <p class="price_info">仲介手数料無料</p>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="w_property-archive_head">
                                            <div class="property-archive_head">
                                                <div class="property_info">
                                                    <p class="property_name">麻布狸穴ナショナルコート</p>
                                                    <p class="property_address">
                                                        <span>東京都中央区日本橋／56.56㎡／ワンルーム</span>
                                                    </p>
                                                </div>
                                                <!-- <div class="property_wishlist">
                                                        <a class="btn_wishlist" href="#"></a>
                                                    </div> -->
                                            </div>
                                        </div>
                                    </a>
                                </div>
                                <div class="property-detail_info">
                                    <img class="img-fluid" src="/assets/images/common/logo-reasy.png" />
                                    <h3>天然木材をふんだんに使った香り高いリノベーション</h3>
                                    <p>
                                        ウォルナット、オークなど人気の天然木をふんだんに使ったパッケージリノベーションです。ドアなどの建具も天然木を使用した「木の香りあふれる部屋」に仕上がります。
                                    </p>
                                    <a href="" class="btn btn-check">詳細をcheck!</a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="detail_swiper_block">
                <div class="container">
                    <div thumbsSlider="" class="detail-slide_swiper_thumbnail">
                        <div class="swiper-wrapper">
                            <div class="swiper-slide">
                                <div class="detail-item_box">
                                    <div class="detail-item_thumnail">
                                        <div class="detail-item_img">
                                            <img
                                                src="/assets/images/property-detail/img2.jpg"
                                                class="img-fluid"
                                                alt=""
                                                title=""
                                            />
                                        </div>
                                        <div class="detail-item_info">
                                            <div class="detail-item_logo">
                                                <img
                                                    src="/assets/images/common/logo-reasy.png"
                                                    class="img-fluid"
                                                    alt=""
                                                    title=""
                                                />
                                            </div>
                                            <h3>３つのスタイルから選ぶ暮らしを変えるリフォーム</h3>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="swiper-slide">
                                <div class="detail-item_box">
                                    <div class="detail-item_thumnail">
                                        <div class="detail-item_img">
                                            <img
                                                src="/assets/images/property-detail/img1.jpg"
                                                class="img-fluid"
                                                alt=""
                                                title=""
                                            />
                                        </div>
                                        <div class="detail-item_info">
                                            <div class="detail-item_logo">
                                                <img
                                                    src="/assets/images/common/logo-assy.png"
                                                    class="img-fluid"
                                                    alt=""
                                                    title=""
                                                />
                                            </div>
                                            <h3>厳選素材とパーツを使った「組み合わせ済みの空間」</h3>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="swiper-slide">
                                <div class="detail-item_box">
                                    <div class="detail-item_thumnail">
                                        <div class="detail-item_img">
                                            <img
                                                src="/assets/images/property-detail/img.jpg"
                                                class="img-fluid"
                                                alt=""
                                                title=""
                                            />
                                        </div>
                                        <div class="detail-item_info">
                                            <div class="detail-item_logo">
                                                <img
                                                    src="/assets/images/common/logo-logrenove.svg"
                                                    class="img-fluid"
                                                    alt=""
                                                    title=""
                                                />
                                            </div>
                                            <h3>厳選素材とパーツを使った「組み合わせ済みの空間」</h3>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!-- <section class="section_subbanner pb-0">
                <div class="container">
                    <div class="pro_main_img">
                        <template v-if="estate.estate_information">
                            <template v-if="estate.estate_information.estate_main_photo[0]">
                                <img
                                v-lazy="estate.estate_information.estate_main_photo[0] ?
                                estate.estate_information.estate_main_photo[0].url_path : '/images/no-image.png'"
                                alt=""
                                class="img-fluid"
                                width="100%"
                                height="100px"
                                />
                            </template>
                        </template>
                        <span class="price">
                            <template v-if="estate.status == '成約済'">
                                成約済
                            </template>
                            <template v-else>
                                {{ $lscFormatCurrency(estate.price) }} 万円
                                <template v-if="estate.renovation_type != 'リノベ済物件'"><span class="renovate_title">（改装前価格）</span></template>
                            </template>
                        </span>
                        
                    </div>
                </div>
            </section> -->
        <!-- <section class="p-0">
                <div class="box_top mb-0">
                    <div class="container">
                        <p class="subtitle mb-2 text-left">
                            <small v-if="estate.estate_information"><b class="estate_name_title">{{ estate.estate_information.article_title }}</b><br>
                                <span>
                                    <template v-if="estate.address"
                                        >{{ estate.address.pref }}{{ estate.address.city }}{{ estate.address.ooaza }}{{ estate.address.tyoume }}{{ estate.address.gaikutiban }}<br />
                                        専有面積{{ estate.tatemono_menseki }}m²
                                        <template v-if="estate.has_balcony != '無'">
                                            ／バルコニー面積: {{ estate.balcony_space}}m²
                                        </template>
                                        <br />
                                        {{ estate.ground_floors ? estate.ground_floors + '階建' : '' }}／{{ estate.structure }}
                                    </template>
                                </span>
                            </small>
                        </p>
                    </div>
                </div>
            </section> -->

        <!-- <section class="p-0 section_carousel">
                <div class="container">
                    <div class="carousel_property">
                        <div class="carousel carousel-main">
                            <div class="carousel-cell" v-for="photo in mainPhoto">
                                <img
                                    :src="photo.url_path ? photo.url_path : '/images/no-image.png'"
                                    alt=""
                                    class="img-fluid"
                                    width="100px"
                                    height="100px"
                                />
                            </div>
                        </div>
                        <div
                            class="carousel carousel-nav"
                            data-flickity='{"asNavFor": ".carousel-main", "contain": true, "prevNextButtons": false, "pageDots": false }'
                        >
                            <div class="carousel-cell" v-for="photo in mainPhoto">
                                <img
                                    :src="photo.url_path ? photo.url_path : '/images/no-image.png'"
                                    alt=""
                                    class="img-fluid"
                                    width="100px"
                                    height="100px"
                                />
                            </div>
                        </div>
                    </div>
                </div>
            </section> -->

        <div class="detail-price">
            <div class="detai-price_info">
                <div class="detail-price_top">
                    <template v-if="estate.status == '成約済'">
                        <div class="name">成約済</div>
                    </template>
                    <template v-else>
                        <div class="name">
                            物件価格<template v-if="estate.renovation_type != 'リノベ済物件'">＋リノベ費用</template>
                        </div>
                        <div class="price">
                            {{ $lscFormatCurrency(estate.price + estate.renovation_cost) }}<span>万円</span>
                        </div>
                        <template v-if="estate.renovation_type != 'リノベ済物件'">
                            <div class="mb-0 mt-2 fee name">
                                物件価格：{{ $lscFormatCurrency(estate.price ? estate.price : estate.price) }}万円
                                ／リノベ費用：{{
                                    $lscFormatCurrency(
                                        estate.renovation_cost ? estate.renovation_cost : estate.renovation_cost
                                    )
                                }}万円
                            </div>
                        </template>
                    </template>
                </div>
                <div class="detail-price_box">
                    <div class="name_payment">
                        毎月のお支払例
                    </div>
                    <div class="payment">
                        <div>
                            <span class="all yellow">{{ $lscFormatCurrency(paymentMonthly) }}</span
                            ><span class="yellow">円</span>
                        </div>
                        <!-- <div>ボーナス月 <span class="more">+0</span>円</div> -->
                    </div>
                    <div class="note">
                        管理費：{{ $lscFormatCurrency(estate.management_fee) }}円／修繕積立金：{{
                            $lscFormatCurrency(estate.repair_reserve_fee)
                        }}円 含む
                        <template v-if="estate.renovation_type != 'リノベ済物件'"
                            >／リノ<br /><br />
                            ベーション費用含む
                        </template>
                    </div>
                </div>
                <div class="detail-price-calculator">
                    <form action="" class="frm_calcu">
                        <div class="row">
                            <div class="col-7">
                                <div class="form-group">
                                    <label for=""><b>毎月のローン返済額</b></label>
                                    <input
                                        type="text"
                                        class="form-control"
                                        placeholder="155,089"
                                        :value="$lscFormatCurrency(monthlyLoan)"
                                    />
                                    <span class="unit">円</span>
                                    <!-- <p class="label_repayment_amount">
                                        {{ $lscFormatCurrency(monthlyLoan) }}<span><b>円</b></span>
                                    </p> -->
                                    <input
                                        type="hidden"
                                        class="form-control monthly-loan-payment"
                                        :value="[[$lscFormatCurrency(monthlyLoan)]]"
                                    />
                                </div>
                                <div class="form-group">
                                    <label for=""><b>ボーナス分返済金額（年2回）</b></label>
                                    <input
                                        type="text"
                                        class="form-control"
                                        ref="lscBonus"
                                        v-on:change="changeMoney('lscBonus', $event)"
                                        :value="[[$lscFormatCurrency(bonus)]]"
                                    />
                                    <span class="unit">円/回</span>
                                </div>
                                <div class="form-group">
                                    <label>管理費</label>
                                    <div>
                                        {{ $lscFormatCurrency(estate.management_fee) }}<span class="unit">円／月</span>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label class="mb-0" for="">修繕積立金</label>
                                    <div>
                                        {{ $lscFormatCurrency(estate.repair_reserve_fee)
                                        }}<span class="unit">円／月</span>
                                    </div>
                                </div>
                            </div>
                            <div class="col-5">
                                <pie-chart-component :parent-data="chartData"></pie-chart-component>
                            </div>
                            <div class="col-12">
                                <div class="row">
                                    <div class="col-6">
                                        <div class="form-group">
                                            <label>自己資金（頭金）</label>
                                            <input
                                                type="text"
                                                class="form-control"
                                                maxlength="4"
                                                ref="lscOwnMoney"
                                                v-on:change="changeMoney('lscOwnMoney', $event)"
                                                :value="[[$lscFormatCurrency(ownMoney)]]"
                                            />
                                            <span class="unit">万円</span>
                                        </div>
                                    </div>
                                    <div class="col-6">
                                        <div class="form-group">
                                            <label>借入れ額（ローン）</label>
                                            <input
                                                type="text"
                                                class="form-control"
                                                maxlength="4"
                                                ref="lscBorrowedMoney"
                                                v-on:change="changeMoney('lscBorrowedMoney', $event)"
                                                :value="[[$lscFormatCurrency(borrowedMoney)]]"
                                            />
                                            <span class="unit">万円</span>
                                        </div>
                                    </div>
                                    <div class="col-12">
                                        <div class="form-group mb-40">
                                            <input
                                                type="text"
                                                class="js-range-slider"
                                                ref="lscMoneyRange"
                                                name="my_range"
                                                value=""
                                            />
                                        </div>
                                    </div>
                                    <div class="col-12">
                                        <div class="form-group">
                                            <label for="">返済期間</label>
                                            <input
                                                type="number"
                                                class="form-control pay-term"
                                                ref="lscPaymentTerm"
                                                min="0"
                                                max="35"
                                                v-on:blur="changeMoney('lscPaymentTerm', $event)"
                                                :value="[[paymentTerm]]"
                                            />
                                            <span class="unit">年</span>
                                        </div>
                                    </div>
                                    <div class="col-12">
                                        <div class="form-group mb-40">
                                            <input type="text" class="js-range-slider1" name="my_range" value="" />
                                        </div>
                                    </div>
                                    <div class="col-12">
                                        <div class="form-group">
                                            <label for="">金利（元利均等）</label>
                                            <input
                                                type="number"
                                                class="form-control interest"
                                                ref="lscPaymentInterest"
                                                min="0"
                                                max="3"
                                                v-on:blur="changeMoney('lscPaymentInterest', $event)"
                                                :value="[[paymentInterest]]"
                                            />
                                            <span class="unit">%</span>
                                        </div>
                                        <div class="form-group mb-40">
                                            <input type="text" class="js-range-slider2" name="my_range" value="" />
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
                <button class="btn btn-clo-ope js-collapse">
                    <i class="c-icon i-open" v-on:click="hiddenPieCal($event)"></i>
                </button>
            </div>
        </div>

        <template v-if="estate.estate_information">
            <template v-for="(photo, indexPhoto) in estate.estate_information.renovation_media">
                <div v-if="indexPhoto == 0" class="bg-gray rnv-explain">
                    <div class="container">
                        <p class="sm-title">INTERIOR</p>
                        <h2>
                            自宅に居ながら<br />
                            森林浴が楽しめる
                        </h2>
                        <div class="plan_img">
                            <img
                                v-if="photo.url_path != '/images/no-image.png'"
                                v-lazy="photo.url_path ? photo.url_path : '/images/no-image.png'"
                                alt=""
                                class="img-fluid"
                                width="600px"
                            />
                        </div>
                        <div class="plan_info"><p v-html="photo.description"></p></div>
                    </div>
                </div>
                <div v-else class="rnv-explain">
                    <div class="container">
                        <template v-if="indexPhoto == 1">
                            <p class="sm-title">PROPERTY</p>
                            <h2>
                                原宿・徒歩圏内の<br />
                                スタイリッシュレジデンス
                            </h2>
                        </template>

                        <div class="plan_info"><p v-html="photo.description"></p></div>
                        <div class="plan_img">
                            <img
                                v-if="photo.url_path != '/images/no-image.png'"
                                v-lazy="photo.url_path ? photo.url_path : '/images/no-image.png'"
                                alt=""
                                class="img-fluid"
                                width="600px"
                            />
                        </div>
                    </div>
                </div>
            </template>
        </template>
        <div class="rnv-explain">
            <div class="container">
                <p class="sm-title">SPEC</p>
                <div class="plan_table">
                    <table>
                        <tbody>
                            <tr>
                                <th width="45%">マンション名</th>
                                <td>{{ estate.estate_name }}{{ estate.area_bldg_name }}</td>
                            </tr>
                            <tr>
                                <th>住所</th>
                                <td>
                                    <template v-if="estate.address">
                                        <div v-if="estate.address.zipcode">〒 {{ estate.address.zipcode }}</div>
                                        {{ estate.address.pref }}{{ estate.address.city }}{{ estate.address.ooaza
                                        }}{{ estate.address.tyoume }}{{ estate.address.gaikutiban }}
                                    </template>
                                </td>
                            </tr>
                            <tr>
                                <th>アクセス</th>
                                <td>
                                    <template v-if="estate.transports">
                                        <div v-for="transport in estate.transports">
                                            {{ transport.transport_company }}
                                            {{ transport.station_name ? transport.station_name + '駅' : '' }}
                                            {{ transport.station_to == 'walk' ? '徒歩' : ''
                                            }}{{ transport.walk_mins ? transport.walk_mins + '分' : '' }}
                                        </div>
                                    </template>
                                </td>
                            </tr>
                            <template v-if="estate.status != '成約済'">
                                <tr>
                                    <th>物件価格</th>
                                    <td>{{ $lscFormatCurrency(estate.price) }}万円</td>
                                </tr>
                            </template>

                            <template v-if="estate.renovation_type != 'リノベ済物件' && estate.status != '成約済'">
                                <tr>
                                    <th>リノベーション費用</th>
                                    <td>{{ $lscFormatCurrency(estate.renovation_cost) }}万円</td>
                                </tr>
                            </template>
                            <tr v-if="estate.management_fee">
                                <th>管理費</th>
                                <td>{{ $lscFormatCurrency(estate.management_fee) }}円/月</td>
                            </tr>
                            <tr v-if="estate.management_fee && estate.repair_reserve_fee">
                                <th>修繕積立金</th>
                                <td>{{ $lscFormatCurrency(estate.repair_reserve_fee) }}円/月</td>
                            </tr>
                            <tr>
                                <th>その他費用</th>
                                <td>
                                    <template v-if="estate.repair_reserve_initial_fee">
                                        <div>修繕積立基金：{{ estate.repair_reserve_initial_fee }}円</div>
                                    </template>
                                    <template v-if="estate.carpark_fee_min">
                                        <div>
                                            駐車場：{{ $lscFormatCurrency(estate.carpark_fee_min) }}円/{{
                                                estate.carpark_manage_fee.per == 'm' ? '月' : '年'
                                            }}
                                        </div>
                                    </template>
                                    <template v-if="estate.bike_park_price">
                                        <div>
                                            バイク：{{ $lscFormatCurrency(estate.bike_park_price) }}円/{{
                                                estate.bike_park_price_per == 'm' ? '月' : '年'
                                            }}
                                        </div>
                                    </template>
                                    <template v-if="estate.bicycles_park_price">
                                        <div>
                                            駐輪場：{{ $lscFormatCurrency(estate.bicycles_park_price) }}円/{{
                                                estate.bicycles_park_price_per == 'm' ? '月' : '年'
                                            }}
                                        </div>
                                    </template>
                                    <template v-if="estate.homes">
                                        <template v-if="carParkNote">
                                            <div v-html="carParkNote"></div>
                                        </template>
                                    </template>
                                    <template v-if="estate.usen_fee || estate.internet_fee || estate.catv_fee">
                                        <template
                                            v-if="
                                                (estate.usen_fee.initial_cost && estate.usen_fee.repeat_cost.price) ||
                                                    (estate.internet_fee.initial_cost &&
                                                        estate.internet_fee.repeat_cost.price) ||
                                                    (estate.catv_fee.initial_cost && estate.catv_fee.repeat_cost.price)
                                            "
                                        >
                                            <div>
                                                設備費用：
                                                <ul
                                                    v-if="
                                                        estate.usen_fee.initial_cost &&
                                                            estate.usen_fee.repeat_cost.price
                                                    "
                                                >
                                                    <li>
                                                        有線放送：
                                                        <ul>
                                                            <li>
                                                                初期費用:
                                                                {{ $lscFormatCurrency(estate.usen_fee.initial_cost) }}円
                                                            </li>
                                                            <li>
                                                                定額費用:
                                                                {{
                                                                    $lscFormatCurrency(
                                                                        estate.usen_fee.repeat_cost.price
                                                                    )
                                                                }}円/{{
                                                                    estate.usen_fee.repeat_cost.per == 'm' ? '月' : '年'
                                                                }}
                                                            </li>
                                                        </ul>
                                                    </li>
                                                </ul>
                                                <ul
                                                    v-if="
                                                        estate.internet_fee.initial_cost &&
                                                            estate.internet_fee.repeat_cost.price
                                                    "
                                                >
                                                    <li>
                                                        インターネット：
                                                        <ul>
                                                            <li>
                                                                初期費用:
                                                                {{
                                                                    $lscFormatCurrency(
                                                                        estate.internet_fee.initial_cost
                                                                    )
                                                                }}円
                                                            </li>
                                                            <li>
                                                                定額費用:
                                                                {{
                                                                    $lscFormatCurrency(
                                                                        estate.internet_fee.repeat_cost.price
                                                                    )
                                                                }}円/{{
                                                                    estate.internet_fee.repeat_cost.per == 'm'
                                                                        ? '月'
                                                                        : '年'
                                                                }}
                                                            </li>
                                                        </ul>
                                                    </li>
                                                </ul>
                                                <ul
                                                    v-if="
                                                        estate.catv_fee.initial_cost &&
                                                            estate.catv_fee.repeat_cost.price
                                                    "
                                                >
                                                    <li>
                                                        CATV：
                                                        <ul>
                                                            <li>
                                                                初期費用:
                                                                {{ $lscFormatCurrency(estate.catv_fee.initial_cost) }}円
                                                            </li>
                                                            <li>
                                                                定額費用:
                                                                {{
                                                                    $lscFormatCurrency(
                                                                        estate.catv_fee.repeat_cost.price
                                                                    )
                                                                }}円/{{
                                                                    estate.catv_fee.repeat_cost.per == 'm' ? '月' : '年'
                                                                }}
                                                            </li>
                                                        </ul>
                                                    </li>
                                                </ul>
                                            </div>
                                        </template>
                                    </template>
                                    <template v-if="estate.community_fee_type && estate.community_fee.price">
                                        <div>
                                            {{ estate.community_fee_type }}：{{
                                                $lscFormatCurrency(estate.community_fee.price)
                                            }}円/<template v-if="estate.community_fee.per == 'm'">月</template
                                            ><template v-else-if="estate.community_fee.per == 'y'">年</template
                                            ><template v-else>一括</template>
                                        </div>
                                    </template>
                                    <template v-if="estate.spa_fee && estate.spa_fee.price">
                                        <div>
                                            温泉使用料：{{ $lscFormatCurrency(estate.spa_fee.price) }}円/<template
                                                v-if="estate.spa_fee.per == 'm'"
                                                >月</template
                                            ><template v-else-if="estate.spa_fee.per == 'y'">年</template
                                            ><template v-else>一括</template>
                                        </div>
                                    </template>
                                    <template v-if="otherFee.length > 0">
                                        <div v-for="fees in otherFee">
                                            {{ fees.name }} : {{ $lscFormatCurrency(fees.price) }}円/<template
                                                v-if="fees.per == 'm'"
                                                >月</template
                                            ><template v-else-if="fees.per == 'y'">年</template
                                            ><template v-else>一括</template>
                                        </div>
                                    </template>
                                    <template v-if="estate.rights_fee && estate.rights_fee.fee">
                                        <div>権利金：{{ $lscFormatCurrency(estate.rights_fee.fee) }}円</div>
                                    </template>
                                    <template v-if="estate.deposit_fee && estate.deposit_fee.fee">
                                        <div>保証金：{{ $lscFormatCurrency(estate.deposit_fee.fee) }}円</div>
                                    </template>
                                    <template v-if="estate.guarantee_fee_depreciation">
                                        <div>
                                            保証金償却：{{ estate.guarantee_fee_depreciation
                                            }}{{ estate.deposit_fee.fee ? estate.deposit_fee.fee : '' }}
                                        </div>
                                    </template>
                                    <template v-if="estate.guarantee_fee && estate.guarantee_fee.fee">
                                        <div>敷金：{{ $lscFormatCurrency(estate.guarantee_fee.fee) }}円</div>
                                    </template>
                                </td>
                            </tr>
                            <tr v-if="estate.tatemono_menseki">
                                <th>専有面積</th>
                                <td>{{ estate.tatemono_menseki }}m²</td>
                            </tr>
                            <tr v-if="estate.balcony_space">
                                <th>バルコニー面積</th>
                                <td>{{ estate.balcony_space }}m²</td>
                            </tr>
                            <tr>
                                <th>間取り</th>
                                <td>
                                    {{ estate.room_count }}{{ estate.room_kind
                                    }}<template v-if="estate.service_rooms == 0"></template>
                                    <template v-else-if="estate.service_rooms == 1">+S</template>
                                    <template v-else-if="estate.service_rooms == 2">+SS</template>
                                    <template v-if="estate.service_rooms == 3">+SSS</template>
                                </td>
                            </tr>
                            <tr>
                                <th>引渡時期</th>
                                <td>
                                    <template v-if="estate.delivery">
                                        <template v-if="estate.delivery.delivery_date_type == '即'">{{
                                            estate.delivery.delivery_date_type
                                        }}</template>
                                        <template v-else-if="estate.delivery.delivery_date_type == '相談'">{{
                                            estate.delivery.delivery_date_type
                                        }}</template>
                                        <template v-else-if="estate.delivery.delivery_date_type == '指定有り'"
                                            >{{ estate.delivery.delivery_date_type }}
                                            {{
                                                dayjs(parseInt(estate.delivery.delivery_date.$date.$numberLong)).format(
                                                    'YYYY年MM月'
                                                )
                                            }}{{ estate.delivery.delivery_date_about }}</template
                                        >
                                        <template v-else>契約後 {{ estate.delivery.resident_span }} ヶ月</template>
                                    </template>
                                </td>
                            </tr>
                            <tr>
                                <th>構造</th>
                                <td>{{ estate.structure ? estate.structure : '' }}</td>
                            </tr>
                            <tr>
                                <th>階建・所在階</th>
                                <td>
                                    <template v-if="estate.total_houses != 0">
                                        {{ estate.ground_floors }}階建／{{ estate.room_floor }}階部分
                                    </template>
                                </td>
                            </tr>
                            <tr>
                                <th>総戸数</th>
                                <td>{{ estate.total_houses }}戸</td>
                            </tr>
                            <tr>
                                <th>方角</th>
                                <td>
                                    <template v-if="estate.window_direction == 'n'">北</template>
                                    <template v-if="estate.window_direction == 'ne'">北東</template>
                                    <template v-if="estate.window_direction == 'e'">東</template>
                                    <template v-if="estate.window_direction == 'se'">南東</template>
                                    <template v-if="estate.window_direction == 's'">南</template>
                                    <template v-if="estate.window_direction == 'sw'">南西</template>
                                    <template v-if="estate.window_direction == 'w'">西</template>
                                    <template v-if="estate.window_direction == 'nw'">北西</template>
                                </td>
                            </tr>
                            <tr>
                                <th>築年月</th>
                                <td>
                                    {{
                                        estate.built_date
                                            ? dayjs(parseInt(estate.built_date.$date.$numberLong)).format('YYYY年MM月')
                                            : ''
                                    }}
                                </td>
                            </tr>
                            <tr>
                                <th>管理会社</th>
                                <td>
                                    {{ estate.management_company }}
                                </td>
                            </tr>
                            <tr>
                                <th>管理形態・管理方式</th>
                                <td>
                                    {{ estate.management_scope
                                    }}{{ estate.superintendent ? '／' + estate.superintendent : '' }}
                                </td>
                            </tr>
                            <tr>
                                <th>土地権利</th>
                                <td>
                                    <template v-if="estate.land_rights == '所有権のみ'">
                                        <div>{{ estate.land_rights }}</div>
                                    </template>
                                    <template v-else-if="estate.land_rights == '借地権のみ'">
                                        {{ estate.land_rights_detail }}
                                        <template v-if="estate.land_leashold_type == '新規'">
                                            ({{ estate.land_leashold_years }}年 {{ estate.land_leashold_months }}月)
                                        </template>
                                        <template v-if="estate.land_leashold_type == '残存'">
                                            （～{{ estate.land_leashold_type }}
                                            {{
                                                dayjs(parseInt(estate.land_leashold_limit.$date.$numberLong)).format(
                                                    'YYYY年MM月DD日迄'
                                                )
                                            }})
                                        </template>
                                        <template v-if="estate.land_fee_type != '無'">
                                            <div>
                                                借地料: {{ estate.land_fee }}円/
                                                <template v-if="estate.land_fee_per == 'm'">月</template>
                                                <template v-else-if="estate.land_fee_per == 'y'">年</template>
                                                <template v-else>一括</template>
                                            </div>
                                        </template>
                                    </template>
                                    <template v-else-if="estate.land_rights == '所有権・借地権混在'">
                                        <div>
                                            {{ estate.land_rights }}
                                        </div>
                                        <div v-if="estate.land_rights_detail">
                                            借地権種類：{{ estate.land_rights_detail }}
                                            <template v-if="estate.land_leashold_type == '新規'">
                                                ({{ estate.land_leashold_years }}年 {{ estate.land_leashold_months }}月)
                                            </template>
                                            <template v-if="estate.land_leashold_type == '残存'">
                                                （～{{
                                                    dayjs(
                                                        parseInt(estate.land_leashold_limit.$date.$numberLong)
                                                    ).format('YYYY年MM月DD日迄')
                                                }})
                                            </template>
                                        </div>
                                        <div v-if="estate.leasehold_ratio">
                                            借地権割合：{{ estate.leasehold_ratio }}%
                                        </div>
                                        <template v-if="estate.land_fee_type != '無'">
                                            <div>
                                                地代: {{ estate.land_fee }}円
                                                <template v-if="estate.land_fee_per == 'm'">/月</template>
                                                <template v-else-if="estate.land_fee_per == 'y'">/年</template>
                                                <template v-else>/一括</template>
                                            </div>
                                        </template>
                                    </template>
                                </td>
                            </tr>
                            <tr>
                                <th>現況</th>
                                <td>{{ estate.house_status }}</td>
                            </tr>
                            <tr>
                                <th>国土法</th>
                                <td>{{ estate.land_law_report }}</td>
                            </tr>
                            <tr>
                                <th>取引態様</th>
                                <td>{{ estate.trade_type }}</td>
                            </tr>
                            <tr>
                                <th>情報更新日</th>
                                <td>
                                    {{ dayjs(estate.date_last_modified).format('YYYY年MM月DD日') }}
                                </td>
                            </tr>
                            <tr>
                                <th>更新予定日</th>
                                <td>
                                    {{
                                        dayjs()
                                            .day(8)
                                            .format('YYYY年MM月DD日')
                                    }}
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                <div class="plan_map map" v-html="srcMap">
                    <div class="row">
                        <div class="col-8 col-lg-8">
                            <p v-if="estate.address">
                                {{ estate.address.pref ? estate.address.pref : ''
                                }}{{ estate.address.city ? estate.address.city : ''
                                }}{{ estate.address.ooaza ? estate.address.ooaza : ''
                                }}{{ estate.address.tyoume ? estate.address.tyoume : ''
                                }}{{ estate.address.hidden ? estate.address.hidden : '' }}
                            </p>
                        </div>
                        <div class="col-4 col-lg-4">
                            <p class="text-right">
                                <a target="_blank" class="btn_viewmap" href="#">マップで見る</a>
                            </p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <section class="section_near_property">
            <div class="container">
                <div class="row">
                    <div class="col-12 col-lg-12">
                        <template v-if="estate.address">
                            <h2 class="title">{{ estate.address.city }}エリアの物件</h2>
                        </template>

                        <template v-if="estate._id">
                            <div>
                                <estates-near-component :estate-id="estate._id"></estates-near-component>
                            </div>
                        </template>
                        <p class="text-center mt-3">
                            <a class="btn btn-load-more" href="/list">Load more</a>
                        </p>
                    </div>
                </div>
            </div>
        </section>
    </div>
    <!-- </main> -->
</template>

<script>
import dayjs from 'dayjs';
import Lazyload from 'vue-lazyload';
import Vue from 'vue';

Vue.use(Lazyload, {
    preLoad: 1.3,
    error: '../images/no-image.png',
    loading: '../images/loading1.gif',
    attempt: 1
});
export default {
    components: {
        EstatesNearComponent: () => import('../components/EstatesNearComponent'),
        PieChartComponent: () => import('../components/PieChartComponent')
    },
    data() {
        return {
            estate: [],
            mainPhoto: '/assets/images/bg_top.jpg',
            slider: [],
            haveEstate: false,
            dayjs: dayjs,
            estateInfo: [],
            imageBefore: '',
            imageAfter: '',
            otherFee: [],
            payTerm: '',
            srcMap: '',
            srcStreetView: '',
            mobileShow: false,
            ownMoney: 0,
            borrowedMoney: 0,
            paymentTerm: 35,
            paymentInterest: 0.8,
            monthlyLoan: 0,
            paymentMonthly: 0,
            paymentMonthlyBonus: 0,
            bonus: 0,
            chartData: [10, 10, 80],
            totalPrice: 0,
            mobileFirstTime: true,
            carParkNote: '',
            everyMonday: '',
            district: {}
        };
    },
    mounted() {
        const payTerm = $('.js-range-slider1');
        payTerm.ionRangeSlider({
            min: 0,
            max: 35,
            from: 35,
            postfix: '年'
        });

        payTerm.on('change', data => {
            this.paymentTerm = parseFloat(data.currentTarget.value);
            this.calculateMonthlyLoanPayment();
        });

        const interest = $('.js-range-slider2');
        interest.ionRangeSlider({
            min: 0,
            max: 3,
            from: 0.8,
            step: 0.1,
            postfix: '%'
        });

        interest.on('change', data => {
            this.paymentInterest = parseFloat(data.currentTarget.value);
            this.calculateMonthlyLoanPayment();
        });
        this.getListEstates();
    },
    watch: {
        totalPrice: function(newValue, oldValue) {
            $('.js-range-slider').ionRangeSlider({
                min: 0,
                max: parseInt(newValue),
                step: 100,
                onChange: data => {
                    this.ownMoney = data.from;
                    this.borrowedMoney = this.totalPrice - this.ownMoney;
                    this.calculateMonthlyLoanPayment();
                }
            });
        }
    },
    methods: {
        getListEstates() {
            const id = this.$route.params.estateId;
            let data = {};
            if (id.length) {
                data.id = id;
                this.$store
                    .dispatch('getEstate', data)
                    .then(resp => {
                        this.estate = resp.data.data.estate[0];
                        this.district = resp.data.data.district;
                        window.localStorage.setItem('estateName', this.estate.estate_name);
                        if (this.estate['estate_information']) {
                            if (this.estate['estate_information']['estate_main_photo']) {
                                this.mainPhoto = this.estate['estate_information']['estate_main_photo'];
                            }
                            if (this.estate['other_fee']) {
                                let data = {};
                                this.estate['other_fee'].forEach((element, key) => {
                                    if (element.name && element.fee.price) {
                                        data = {
                                            name: element.name,
                                            price: element.fee.price,
                                            per: element.fee.per
                                        };
                                        this.otherFee.push(data);
                                    }
                                });
                            }
                            this.estateInfo = this.estate['estate_information'];
                            this.borrowedMoney = this.estate.price + this.estate.renovation_cost;
                            this.totalPrice = this.estate.price + this.estate.renovation_cost;
                            // this.calculateMonthlyLoanPayment();
                            this.srcMap = this.estate['estate_information']['url_map'];
                            this.srcStreetView = this.estate['estate_information']['url_view_street'];
                        }
                        let carParkNote = this.estate['homes']['carpark_note'];
                        this.carParkNote = carParkNote.replace(/\n/g, '<br>');
                    })
                    .catch(error => {
                        this.$router.push({ name: 'home' }).catch(() => {});
                    });
            }
        },
        mobileHandleShow() {
            this.mobileShow = !this.mobileShow;
            if (this.mobileFirstTime) {
                this.chartData = [this.estate.management_fee, this.estate.repair_reserve_fee, this.monthlyLoan];
                this.mobileFirstTime = false;
            }
        },
        changeRangeSlider(type, from) {
            let elementClass = '';
            switch (type) {
                case 'ownMoney':
                    elementClass = '.js-range-slider';
                    break;
                case 'paymentTerm':
                    elementClass = '.js-range-slider1';
                    break;
                case 'paymentInterest':
                    elementClass = '.js-range-slider2';
                    break;
            }
            if (elementClass.length > 0) {
                $(elementClass)
                    .data('ionRangeSlider')
                    .update({
                        from: from
                    });
            }
        },
        changeMoney(type, event) {
            event.preventDefault();
            let currentValue = parseFloat(event.target.value);
            switch (type) {
                case 'lscOwnMoney':
                    if (this.ownMoney == currentValue) {
                        return;
                    }
                    this.ownMoney = currentValue;
                    this.borrowedMoney = this.estate.price - this.ownMoney;
                    this.changeRangeSlider('ownMoney', this.ownMoney);
                    break;
                case 'lscBorrowedMoney':
                    if (this.borrowedMoney == currentValue) {
                        return;
                    }
                    this.borrowedMoney = currentValue;
                    this.ownMoney = this.estate.price - this.borrowedMoney;
                    this.changeRangeSlider('ownMoney', this.ownMoney);
                    break;
                case 'lscPaymentTerm':
                    if (this.paymentTerm == currentValue) {
                        return;
                    }
                    let currentPaymentTerm = currentValue;
                    if (currentPaymentTerm < 0) {
                        this.paymentTerm = 0;
                    } else if (currentPaymentTerm > 35) {
                        this.paymentTerm = 35;
                    } else {
                        this.paymentTerm = currentPaymentTerm;
                    }
                    this.changeRangeSlider('paymentTerm', this.paymentTerm);
                    break;
                case 'lscPaymentInterest':
                    if (this.paymentInterest == currentValue) {
                        return;
                    }
                    let currentPaymentInterest = currentValue;
                    if (currentPaymentInterest < 0) {
                        this.paymentInterest = 0;
                    } else if (currentPaymentInterest > 3) {
                        this.paymentInterest = 3;
                    } else {
                        this.paymentInterest = currentPaymentInterest;
                    }
                    this.changeRangeSlider('paymentInterest', this.paymentInterest);
                    break;
                case 'lscBonus':
                    if (this.bonus == currentValue) {
                        return;
                    }
                    this.bonus = currentValue;
                    break;
                default:
                    break;
            }
            this.calculateMonthlyLoanPayment();
        },
        calculateMonthlyLoanPayment() {
            let interestPercen = this.paymentInterest / 100;
            let paymentTerm12 = this.paymentTerm * 12;
            let interest12 = 1 + interestPercen / 12;
            let interestWithMonth = Math.pow(interest12, paymentTerm12);
            let calBorrowedMoney = this.borrowedMoney * 10000;

            if (this.paymentTerm <= 0) {
                this.monthlyLoan = calBorrowedMoney;
            } else if (this.paymentInterest <= 0) {
                this.monthlyLoan = Math.ceil(calBorrowedMoney / paymentTerm12);
            } else {
                let sharePart = calBorrowedMoney * (interestPercen / 12) * interestWithMonth;
                let dividedPart = interestWithMonth - 1;
                this.monthlyLoan = Math.ceil(sharePart / dividedPart);
            }
            this.paymentMonthly = Math.ceil(
                this.monthlyLoan + this.estate.management_fee + this.estate.repair_reserve_fee
            );
            this.paymentMonthlyBonus = Math.ceil(this.paymentMonthly + this.bonus / 6);
            this.chartData = [this.estate.management_fee, this.estate.repair_reserve_fee, this.monthlyLoan];
        },

        hiddenPieCal(event) {
            let element = $(event.target);
            let cal = $('.detail-price-calculator');
            if (element.hasClass('i-open')) {
                element.removeClass('i-open');
                element.addClass('i-close');
                cal.addClass('collapse-animation');
                cal.css('display', 'block');
            } else {
                element.removeClass('i-close');
                cal.css('display', 'none');
                element.addClass('i-open');
                cal.removeClass('collapse-animation');
            }
        }
    },
    updated() {
        $('.slider-detail').flickity({
            wrapAround: true,
            prevNextButtons: false,
            autoPlay: true
        });
        $('.carousel-main').flickity({
            contain: true,
            pageDots: false,
            initialIndex: 1
        });
        $('.carousel-nav').flickity({
            asNavFor: '.carousel-main',
            contain: true,
            pageDots: false,
            prevNextButtons: false
        });
        if ($('.detail-slide_swiper_thumbnail').length != 0) {
            var swiper = new Swiper('.detail-slide_swiper_thumbnail', {
                spaceBetween: 30,
                slidesPerView: 3,
                breakpoints: {
                    320: {
                        slidesPerView: 2.5,
                        spaceBetween: 5
                    },
                    767: {
                        slidesPerView: 3
                    }
                },
                freeMode: true,
                watchSlidesProgress: true
            });
        }
        var swiper2 = new Swiper('.detail-slide_swiper', {
            spaceBetween: 30,
            slidesPerView: 1,
            thumbs: {
                swiper: swiper
            }
        });
    },
    created() {
        window.onload = function() {
            window.onpopstate = function() {
                window.location.reload();
            };
        };
    },
    beforeUpdate() {
        $('.js-range-slider1').trigger('change');
    }
};
</script>
